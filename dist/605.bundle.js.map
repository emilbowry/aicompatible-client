{"version":3,"file":"605.bundle.js","mappings":"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","sources":["webpack://simpleapp/./src/pages/dpo-tool/CSS_Markdown/mardown-viewer/MarkDownViewer.tsx","webpack://simpleapp/./src/pages/dpo-tool/CSS_Markdown/CSSMarkdown.styles.ts","webpack://simpleapp/./src/pages/dpo-tool/CSS_Markdown/mardown-viewer/DataUtils.ts","webpack://simpleapp/./src/pages/dpo-tool/CSS_Markdown/CSSMarkdown.tsx","webpack://simpleapp/./src/pages/dpo-tool/tool.tsx","webpack://simpleapp/./src/pages/demo/DemoPage.tsx"],"sourcesContent":["import React from \"react\";\nimport ReactMarkdown, { Components } from \"react-markdown\";\nimport { visit } from \"unist-util-visit\";\nimport remarkGfm from \"remark-gfm\";\nimport { IHighlightNode, IFlatSegment, ITextNode } from \"../CSSMarkdown.types\";\n\nconst toCssClass = (id: string) => {\n\treturn `hl-${id.replace(/[^a-zA-Z0-9]/g, \"_\")}`;\n};\nconst remarkHighlightPlugin = (options: { segments: IFlatSegment[] }) => {\n\treturn (tree: any) => {\n\t\tconst { segments } = options;\n\t\tif (!segments.length) return;\n\n\t\tvisit(tree, \"text\", (node: any, index, parent) => {\n\t\t\tif (!parent || index === undefined) return;\n\t\t\tif (!node.position) return;\n\n\t\t\tconst textNode = node as ITextNode;\n\t\t\tconst nodeStart = node.position.start.offset;\n\t\t\tconst nodeEnd = node.position.end.offset;\n\n\t\t\tconst relevantSegments = segments.filter(\n\t\t\t\t(s) => s.start < nodeEnd && s.end > nodeStart\n\t\t\t);\n\n\t\t\tif (relevantSegments.length === 0) return;\n\n\t\t\tconst newChildren: (ITextNode | IHighlightNode)[] = [];\n\t\t\tlet cursor = nodeStart;\n\n\t\t\trelevantSegments.sort((a, b) => a.start - b.start);\n\n\t\t\tfor (const seg of relevantSegments) {\n\t\t\t\tif (cursor < seg.start) {\n\t\t\t\t\tnewChildren.push({\n\t\t\t\t\t\ttype: \"text\",\n\t\t\t\t\t\tvalue: textNode.value.slice(\n\t\t\t\t\t\t\tcursor - nodeStart,\n\t\t\t\t\t\t\tseg.start - nodeStart\n\t\t\t\t\t\t),\n\t\t\t\t\t});\n\t\t\t\t\tcursor = seg.start;\n\t\t\t\t}\n\n\t\t\t\tconst hStart = Math.max(cursor, seg.start);\n\t\t\t\tconst hEnd = Math.min(nodeEnd, seg.end);\n\n\t\t\t\tif (hStart < hEnd) {\n\t\t\t\t\tconst textContent = textNode.value.slice(\n\t\t\t\t\t\thStart - nodeStart,\n\t\t\t\t\t\thEnd - nodeStart\n\t\t\t\t\t);\n\n\t\t\t\t\t// Safe CSS Class Generation\n\t\t\t\t\tconst classNames = seg.ids\n\t\t\t\t\t\t.map((id) => toCssClass(id))\n\t\t\t\t\t\t.join(\" \");\n\n\t\t\t\t\tnewChildren.push({\n\t\t\t\t\t\ttype: \"highlight\",\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\thName: \"span\",\n\t\t\t\t\t\t\thProperties: { className: classNames },\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [{ type: \"text\", value: textContent }],\n\t\t\t\t\t});\n\n\t\t\t\t\tcursor = hEnd;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (cursor < nodeEnd) {\n\t\t\t\tnewChildren.push({\n\t\t\t\t\ttype: \"text\",\n\t\t\t\t\tvalue: textNode.value.slice(cursor - nodeStart),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tparent.children.splice(index, 1, ...newChildren);\n\t\t\treturn index + newChildren.length;\n\t\t});\n\t};\n};\nconst MarkdownViewer = React.memo(\n\t({ content, segments }: { content: string; segments: IFlatSegment[] }) => {\n\t\treturn (\n\t\t\t<ReactMarkdown\n\t\t\t\tremarkPlugins={[\n\t\t\t\t\t[remarkHighlightPlugin, { segments }],\n\t\t\t\t\tremarkGfm,\n\t\t\t\t]}\n\t\t\t\tcomponents={\n\t\t\t\t\t{\n\t\t\t\t\t\thighlight: ({ node, ...props }: any) => (\n\t\t\t\t\t\t\t<span {...props} />\n\t\t\t\t\t\t),\n\t\t\t\t\t} as Components\n\t\t\t\t}\n\t\t\t>\n\t\t\t\t{content}\n\t\t\t</ReactMarkdown>\n\t\t);\n\t}\n);\n\nexport { MarkdownViewer, toCssClass };\n","import { THighlightId, THighlightRules } from \"./CSSMarkdown.types\";\nimport { toCssClass } from \"./mardown-viewer/MarkDownViewer\";\nimport { bgwhite } from \"../../../utils/defaultColours\";\nconst DropDownIconStyle = {};\nconst DropDownInputStyle = {};\nconst ButtonStyle: React.CSSProperties = {\n\t// padding: \"8px 12px\",\n\tborder: \"1px solid transparent\",\n\tborderRadius: \"6px\",\n\tcursor: \"pointer\",\n\t// textAlign: \"left\",\n\tbackground: \"red\",\n\t// transition: \"all 0.2s\",\n\t// width: \"100%\",\n\t// marginBottom: \"5px\",\n};\n\nconst DropdownWrapperStyle: React.CSSProperties = {\n\tposition: \"relative\",\n\tdisplay: \"inline-block\",\n\twidth: \"100%\",\n};\n\nconst DropdownMenuStyle: React.CSSProperties = {\n\tposition: \"absolute\",\n\tleft: 0,\n\ttop: \"100%\",\n\n\tmarginTop: \"4px\",\n\tbackgroundColor: \"#fff\",\n\tborder: \"1px solid #ccc\",\n\tborderRadius: \"4px\",\n\tboxShadow: \"0 4px 6px rgba(0,0,0,0.1)\",\n\twidth: \"max-content\",\n\tzIndex: 100,\n\tpadding: \"5px 0\",\n};\n\nconst DropdownItemBaseStyle: React.CSSProperties = {\n\tuserSelect: \"none\",\n\tgap: \"8px\",\n\tpadding: \"8px 12px\",\n\tdisplay: \"flex\",\n\talignItems: \"center\",\n};\n\nconst dropdownItemStyle = (isSelected: boolean): React.CSSProperties => ({\n\t...DropdownItemBaseStyle,\n\tbackgroundColor: isSelected ? \"#f3f4f6\" : \"#fff\",\n});\nconst SelectorButtonStyle: React.CSSProperties = {\n\tpadding: \"8px 16px\",\n\tbackgroundColor: \"#fff\",\n\tborder: \"1px solid #ccc\",\n\tborderRadius: \"4px\",\n\tfontSize: \"14px\",\n\tdisplay: \"flex\",\n\talignItems: \"center\",\n\tjustifyContent: \"space-between\",\n\tminWidth: \"220px\",\n};\nconst ClearButtonWrapperStyle: React.CSSProperties = {\n\tdisplay: \"flex\",\n\tflexDirection: \"column\",\n\twidth: \"100%\",\n\n\talignItems: \"center\",\n};\nconst ClearButtonStyle: React.CSSProperties = {\n\tmarginLeft: \"-40px\",\n\twidth: \"fit-content\",\n\n\tborder: \"1px solid #ccc\",\n\n\tbackground: \"#fff\",\n\tzIndex: 100,\n};\n\nconst EmptyStateStyle: React.CSSProperties = {\n\tfontSize: \"12px\",\n\tcolor: \"#ccc\",\n\t// marginBottom: \"10px\",\n\t// margin: \"auto\",\n};\n\nconst SharedItemsWrapperStyle: React.CSSProperties = {};\n\nconst SharedCategoryButtonStyle: React.CSSProperties = {};\n\nconst GridMessageStyle: React.CSSProperties = {\n\tmargin: \"auto\",\n\tcolor: \"#ccc\",\n};\n\nconst categoryButtonStyle = (\n\tisActive: boolean,\n\tcolor: string,\n\tStyleOverrides: React.CSSProperties = {}\n): React.CSSProperties => {\n\treturn {\n\t\t...ButtonStyle,\n\t\tbackgroundColor: isActive ? color : \"#fff\",\n\t\tborder: isActive ? \"1px solid transparent\" : \"1px solid #d1d5db\",\n\t\tborderLeft: isActive ? \"1px solid transparent\" : `4px solid ${color}`,\n\t\tfontWeight: isActive ? \"bold\" : \"normal\",\n\t\t// margin: \"auto\",\n\t\twidth: \"30vh\",\n\t\theight: \"10vh\",\n\t\tjustifySelf: \"start\",\n\t\t...StyleOverrides,\n\t};\n};\n\nconst dynamicHighlightStyles = (\n\tactiveIds: THighlightId[],\n\tcolorMap: Record<string, string>\n): THighlightRules => {\n\tconst rules: THighlightRules = {};\n\n\tactiveIds.forEach((id) => {\n\t\tconst color = colorMap[id] || \"#ddd\";\n\t\tconst borderColor = color.replace(\"0\", \"8\");\n\n\t\tconst safeClassName = `.${toCssClass(id)}`;\n\n\t\t(rules as any)[safeClassName] = {\n\t\t\tbackgroundColor: color,\n\t\t\tborderBottom: `2px solid ${borderColor}`,\n\t\t\t\"&:hover\": {\n\t\t\t\tfilter: \"brightness(0.95)\",\n\t\t\t},\n\t\t};\n\t});\n\n\treturn rules;\n};\nconst MainContainerStyle = (height_available: string): React.CSSProperties => ({\n\theight: height_available,\n\tbackground: bgwhite,\n\tfontSize: \"12px\",\n});\nconst TopControlBarStyle: React.CSSProperties = {\n\tdisplay: \"flex\",\n\tbackgroundColor: \"#fff\",\n\tborderBottom: \"1px solid #ccc\",\n\tgap: \"15px\",\n\n\tmargin: \"auto\",\n\n\talignItems: \"center\",\n\theight: \"10%\",\n};\nconst SelectLabelStyle: React.CSSProperties = {\n\twidth: \"fit-content\",\n\ttextWrap: \"nowrap\",\n};\nconst CONTENT_GRID_STYLE: React.CSSProperties = {\n\tdisplay: \"grid\",\n\tgridTemplateColumns: \"20% 80%\",\n};\n\nconst ContentHeaderStyle = {\n\t...CONTENT_GRID_STYLE,\n\tbackgroundColor: \"#f9fafb\",\n\theight: \"5%\",\n\tminHeight: \"5%\",\n};\nconst ContentAreaStyle: React.CSSProperties = {\n\t...CONTENT_GRID_STYLE,\n\theight: \"85%\",\n\tmaxHeight: \"85%\",\n\tbackgroundColor: \"#f9fafb\",\n\tborder: \"1px solid #ccc\",\n};\n\nconst SidebarStyle: React.CSSProperties = {};\n\nconst MainContentColumnStyle: React.CSSProperties = {\n\toverflow: \"hidden\",\n};\n\nconst DocGridContainerStyle: React.CSSProperties = {\n\toverflow: \"hidden\",\n};\n\nconst SharedFooterStyle: React.CSSProperties = {\n\theight: \"30%\",\n\tbackgroundColor: \"#fff\",\n\tborderTop: \"1px solid #eee\",\n\tpadding: \"15px\",\n};\n\n// const SidebarSectionStyle: React.CSSProperties = {\n// \t// maxHeight: \"100%\",\n\n// \tflex: 0,\n\n// \tminHeight: 0,\n// };\nconst documentSplitStyle = (\n\tmode = \"SPLIT\",\n\tcolumns: number\n): React.CSSProperties => ({\n\tdisplay: \"grid\",\n\tgridTemplateColumns: `repeat(${columns}, ${100 / columns}%)`,\n\tminHeight: 0,\n});\n\n//\n\nconst DocColumnWrapperStyle: React.CSSProperties = {\n\theight: \"100%\",\n\tminHeight: 0,\n\tpadding: \"0 2%\",\n\toverflow: \"scroll\",\n\n\t//\n};\n\nconst docHeaderStyle = (color: string): React.CSSProperties => ({\n\twidth: \"100%\",\n\tborderBottom: \"1px solid #eee\",\n\tbackgroundColor: \"#fff\",\n\tfontWeight: \"bold\",\n\ttextAlign: \"center\",\n\ttextTransform: \"uppercase\",\n\tfontSize: \"12px\",\n\tletterSpacing: \"1px\",\n\tcolor: \"#444\",\n\tborderTop: `4px solid ${color}`,\n});\n\nconst SECTION_HEADER_HEIGHT = 10;\nconst SectionHeaderStyle: React.CSSProperties = {\n\t// height: `${SECTION_HEADER_HEIGHT}%`,\n\tjustifyContent: \"center\",\n\ttextAlign: \"center\",\n\tminHeight: 0,\n};\nconst sectionHeaderStyle = (\n\tcolor = \"#ccc\",\n\tStyleOverrides = {},\n\tcolumns: number\n): React.CSSProperties => ({\n\theight: `${SECTION_HEADER_HEIGHT * columns}%`,\n\tfontSize: \"16px\",\n\t// position: \"relative\",\n\ttextDecorationLine: `underline`,\n\ttextDecorationColor: color,\n\tcolor: \"#6b7280\",\n\t// marginBottom: \"10px\",\n\t...StyleOverrides,\n});\nconst attrsAreaStyle = (columns: number): React.CSSProperties => ({\n\theight: `${100 - columns * SECTION_HEADER_HEIGHT}%`,\n\toverflow: \"auto\",\n\tminHeight: 0,\n});\nconst UniqueContainerAreaStyle: React.CSSProperties = {\n\t// display: \"grid\",\n\t// gridTemplateRows: `repeat(${columns}, 1fr)`,\n\t// display: \"flex\",\n\t// flexDirection: \"column\",\n\tposition: \"relative\",\n\t// flex: 0,\n\theight: \"100%\",\n\tminHeight: 0,\n\toverflowY: \"scroll\",\n\t// maxHeight: \"100%\",\n\tborderRight: \"1px solid #ccc\",\n};\n\nconst UniqueAttrsHeadingStyle: React.CSSProperties = {\n\tmargin: \"auto\",\n\ttextAlign: \"center\",\n\talignContent: \"center\",\n\tflex: 0,\n\twidth: \"calc(100%)\",\n\t// boxSizing: \"border-box\",\n\tborderRight: \"1px solid #ccc\", // why necessary here but not containerAreaStyle\n\theight: \"100%\",\n};\nexport {\n\tButtonStyle,\n\tUniqueAttrsHeadingStyle,\n\tcategoryButtonStyle,\n\tClearButtonStyle,\n\tContentAreaStyle,\n\tContentHeaderStyle,\n\tDocColumnWrapperStyle,\n\tDocGridContainerStyle,\n\tdocHeaderStyle,\n\tdocumentSplitStyle,\n\tDropDownIconStyle,\n\tDropDownInputStyle,\n\tdropdownItemStyle,\n\tDropdownMenuStyle,\n\tDropdownWrapperStyle,\n\tdynamicHighlightStyles,\n\tGridMessageStyle,\n\tEmptyStateStyle,\n\tMainContainerStyle,\n\tClearButtonWrapperStyle,\n\tMainContentColumnStyle,\n\tsectionHeaderStyle,\n\tSectionHeaderStyle,\n\tSelectLabelStyle,\n\tSelectorButtonStyle,\n\tSharedCategoryButtonStyle,\n\tSharedFooterStyle,\n\tSharedItemsWrapperStyle,\n\tSidebarStyle,\n\tTopControlBarStyle,\n\tattrsAreaStyle,\n\tUniqueContainerAreaStyle,\n};\n","// --- Data Pre-Processing ---\n// Data Imports\nimport local_question_data from \"./output_q.json\";\nimport local_policy_data from \"./output_p.json\";\n\nimport { useState, useContext, useMemo, createContext } from \"react\";\nimport { generateGradient } from \"../../../../styles\";\nimport {\n\tIRawDocLibrary,\n\tIRawAnalysisData,\n\tTDocId,\n\tIDocMeta,\n\tIFlatSegment,\n\tTHighlightId,\n\tIAnalysisUIState,\n} from \"../CSSMarkdown.types\";\n\nconst RAW_DOCS = local_policy_data as unknown as IRawDocLibrary;\nconst RAW_ANALYSIS = local_question_data as unknown as IRawAnalysisData;\n\n// 1. Flatten Documents for O(1) Lookup and Flat UI List\nconst DOC_LOOKUP: Record<TDocId, IDocMeta> = {};\n\nObject.entries(RAW_DOCS).forEach(([policyName, versions]) => {\n\tObject.entries(versions).forEach(([hash, data]) => {\n\t\t// We format the label here once: \"Privacy Policy (2024-01-01)\"\n\t\tDOC_LOOKUP[hash] = {\n\t\t\tcontent: data.policy_content,\n\t\t\tlabel: `${policyName} (${data.fetch_date})`,\n\t\t};\n\t});\n});\n\n// 2. Color Generation\nconst ANALYSIS_KEYS = Object.keys(RAW_ANALYSIS);\nconst GRADIENT_COLORS = generateGradient(ANALYSIS_KEYS.length);\n\nconst ID_COLORS: Record<string, string> = {};\nANALYSIS_KEYS.forEach((key, index) => {\n\tID_COLORS[key] = GRADIENT_COLORS[index];\n});\n\nconst DOC_HASHES = Object.keys(DOC_LOOKUP);\nconst DOC_COLORS_LIST = generateGradient(\n\tDOC_HASHES.length,\n\t\"#16a34a\", // Green\n\t\"#ea580c\" // Orange\n);\n\nconst DOC_THEME_COLORS: Record<string, string> = {};\nDOC_HASHES.forEach((hash, index) => {\n\tDOC_THEME_COLORS[hash] = DOC_COLORS_LIST[index];\n});\n\n// --- Logic Update: Flatten Ranges (New Structure) ---\n\nconst flattenRanges = (\n\tdocId: TDocId,\n\tdata: IRawAnalysisData\n): IFlatSegment[] => {\n\tconst points = new Set<number>();\n\n\tconst rangeMap: { id: THighlightId; start: number; end: number }[] = [];\n\n\tObject.entries(data).forEach(([questionId, docMap]) => {\n\t\tconst occurrences = docMap[docId];\n\n\t\tif (occurrences) {\n\t\t\toccurrences.forEach((instance) => {\n\t\t\t\tconst [start, end] = instance.substring_indices;\n\t\t\t\tpoints.add(start);\n\t\t\t\tpoints.add(end);\n\t\t\t\trangeMap.push({ id: questionId, start, end });\n\t\t\t});\n\t\t}\n\t});\n\n\t// Standard segmentation logic (unchanged)\n\tconst sortedPoints = Array.from(points).sort((a, b) => a - b);\n\tconst segments: IFlatSegment[] = [];\n\n\tfor (let i = 0; i < sortedPoints.length - 1; i++) {\n\t\tconst start = sortedPoints[i];\n\t\tconst end = sortedPoints[i + 1];\n\t\tconst mid = start + (end - start) / 2;\n\n\t\tconst activeIds = rangeMap\n\t\t\t.filter((r) => r.start <= mid && r.end >= mid)\n\t\t\t.map((r) => r.id);\n\n\t\tif (activeIds.length > 0) {\n\t\t\tsegments.push({ start, end, ids: activeIds });\n\t\t}\n\t}\n\n\treturn segments;\n};\n\nconst AnalysisCTX = createContext<IAnalysisUIState>(undefined as any);\n\nconst useAnalysisState = (): IAnalysisUIState => {\n\tconst [activeIds, setActiveIds] = useState<THighlightId[]>([]);\n\tconst [syntheticDocs, setSyntheticDocs] = useState<TDocId[]>([]);\n\n\tconst [selectedDocs, setSelectedDocs] = useState<TDocId[]>([]);\n\tconst [activeDoc, setActiveDoc] = useState<TDocId | null>(null);\n\n\tconst [isDropdownOpen, setIsDropdownOpen] = useState(false);\n\tconst [scrollToId, setScrollToId] = useState<THighlightId | null>(null);\n\n\tconst toggleDoc = (docId: TDocId) => {\n\t\tsetSelectedDocs((prev) =>\n\t\t\tprev.includes(docId)\n\t\t\t\t? prev.filter((d) => d !== docId)\n\t\t\t\t: [...prev, docId]\n\t\t);\n\t};\n\tconst toggleActiveDoc = (docId: TDocId | null) => () => {\n\t\t// selectedDocs.includes(docId)\n\t\tsetActiveDoc(docId);\n\t};\n\t// const toggleActiveDoc = (docId: string | null) => () => {\n\t// \t// 1. Allow clearing explicitly\n\t// \tif (docId === null) {\n\t// \t\tsetActiveDoc(null);\n\t// \t\treturn;\n\t// \t}\n\n\t// \t// 2. Check if valid (Real Doc OR Synthetic Group)\n\t// \tconst isValidReal = selectedDocs.includes(docId as TDocId);\n\t// \tconst isValidSynthetic = syntheticDocs.includes(docId);\n\n\t// \tif (isValidReal || isValidSynthetic) {\n\t// \t\t// 3. Toggle behavior: If clicking the one already open, close it.\n\t// \t\tsetActiveDoc((prev) => (prev === docId ? null : docId));\n\t// \t}\n\t// };\n\tconst toggleId = (id: THighlightId) => {\n\t\tconst isTurningOn = !activeIds.includes(id);\n\t\tconsole.log(\"toggling id\");\n\t\tsetActiveIds((prev) =>\n\t\t\tprev.includes(id) ? prev.filter((x) => x !== id) : [...prev, id]\n\t\t);\n\n\t\tif (isTurningOn) {\n\t\t\tsetScrollToId(id);\n\t\t\tsetTimeout(() => setScrollToId(null), 100);\n\t\t}\n\t};\n\n\treturn {\n\t\tactiveIds,\n\t\tsetActiveIds,\n\t\tsyntheticDocs,\n\t\tsetSyntheticDocs,\n\t\tselectedDocs,\n\t\tsetSelectedDocs,\n\t\tisDropdownOpen,\n\t\tsetIsDropdownOpen,\n\t\ttoggleDoc,\n\t\ttoggleId,\n\t\tscrollToId,\n\t\tactiveDoc,\n\t\ttoggleActiveDoc,\n\t};\n};\nconst useAnalysisContext = () => {\n\tconst context = useContext(AnalysisCTX);\n\tif (!context) {\n\t\tthrow new Error(\n\t\t\t\"useAnalysisContext must be used within an AnalysisCTX Provider\"\n\t\t);\n\t}\n\treturn context;\n};\n\n// --- Logic Update: Categorization (New Structure) ---\n\n// const useDataCategorization = () => {\n// \tconst { selectedDocs } = useAnalysisContext();\n\n// \treturn useMemo(() => {\n// \t\tconst qTypes: Record<THighlightId, \"unique\" | \"shared\"> = {};\n\n// \t\t// A. Determine Global Type using Nested Structure\n// \t\tconst visibleSharedMap: Record<THighlightId, TDocId[]> = {};\n\n// \t\tObject.entries(RAW_ANALYSIS).forEach(([questionId, docMap]) => {\n// \t\t\tconst uniqueDocsForQuestion = new Set(Object.keys(docMap)); // Keys are hashes\n// \t\t\tvisibleSharedMap[questionId] = [];\n// \t\t\tif (uniqueDocsForQuestion.size > 1) {\n// \t\t\t\tqTypes[questionId] = \"shared\";\n// \t\t\t} else {\n// \t\t\t\tqTypes[questionId] = \"unique\";\n// \t\t\t}\n// \t\t});\n\n// \t\tconst visibleUniqueMap: Record<TDocId, THighlightId[]> = {};\n\n// \t\tconst visibleSharedList: THighlightId[] = [];\n\n// \t\tselectedDocs.forEach((docId) => (visibleUniqueMap[docId] = []));\n// \t\t// RAW_ANALYSIS.forEach() => (visibleSharedMap[questionId] = []));\n\n// \t\t// B. Filter for Current View\n// \t\tObject.entries(RAW_ANALYSIS).forEach(([questionId, docMap]) => {\n// \t\t\tconst type = qTypes[questionId];\n\n// \t\t\t// Is this question relevant to ANY selected doc?\n// \t\t\tconst docKeys = Object.keys(docMap);\n// \t\t\tconst isRelevant = docKeys.some((docHash) =>\n// \t\t\t\tselectedDocs.includes(docHash)\n// \t\t\t);\n\n// \t\t\tif (!isRelevant) return;\n\n// \t\t\tif (type === \"shared\") {\n// \t\t\t\tif (!visibleSharedList.includes(questionId)) {\n// \t\t\t\t\tvisibleSharedList.push(questionId);\n// \t\t\t\t}\n// \t\t\t\tconst docId = docKeys[0];\n// \t\t\t\tif (visibleSharedMap[questionId]) {\n// \t\t\t\t\tvisibleSharedMap[questionId].push(docId);\n// \t\t\t\t}\n// \t\t\t} else {\n// \t\t\t\t// It's unique to one doc\n// \t\t\t\tconst docId = docKeys[0];\n// \t\t\t\tif (visibleUniqueMap[docId]) {\n// \t\t\t\t\tvisibleUniqueMap[docId].push(questionId);\n// \t\t\t\t}\n// \t\t\t}\n// \t\t});\n\n// \t\treturn {\n// \t\t\tuniqueMap: visibleUniqueMap,\n// \t\t\tsharedList: visibleSharedList,\n// \t\t\tsharedMap: visibleSharedMap,\n// \t\t};\n// \t}, [selectedDocs]);\n// };\n// client/src/pages/dpo-tool/CSS_Markdown/DataUtils.ts (or wherever this lives)\n// CSSMarkdown/DataUtils.ts\n\nconst useDataCategorization = () => {\n\tconst { selectedDocs } = useAnalysisContext();\n\n\treturn useMemo(() => {\n\t\tconst uniqueMap: Record<string, THighlightId[]> = {};\n\t\tconst localSharedGroups: Record<string, THighlightId[]> = {};\n\t\tconst globalSharedGroups: Record<string, THighlightId[]> = {};\n\n\t\t// We will store all pretty labels here\n\t\tconst groupLabels: Record<string, string> = {};\n\n\t\tselectedDocs.forEach((docId) => (uniqueMap[docId] = []));\n\n\t\tObject.entries(RAW_ANALYSIS).forEach(([questionId, docMap]) => {\n\t\t\tconst allDocKeys = Object.keys(docMap);\n\n\t\t\t// Docs for this attribute that are CURRENTLY visible\n\t\t\tconst visibleDocs = allDocKeys.filter((docHash) =>\n\t\t\t\tselectedDocs.includes(docHash)\n\t\t\t);\n\n\t\t\t// Skip if not present in any selected doc\n\t\t\tif (visibleDocs.length === 0) return;\n\n\t\t\t// --- CATEGORIZATION LOGIC ---\n\n\t\t\tif (visibleDocs.length > 1) {\n\t\t\t\t// CATEGORY A: LOCAL SHARED\n\t\t\t\t// The attribute is shared visibly between 2+ selected docs.\n\t\t\t\t// We group by the visible combination (e.g., \"DocA|DocB\")\n\t\t\t\tvisibleDocs.sort();\n\t\t\t\tconst key = visibleDocs.join(\"|\");\n\n\t\t\t\tif (!localSharedGroups[key]) {\n\t\t\t\t\tlocalSharedGroups[key] = [];\n\t\t\t\t\tconst names = visibleDocs.map(\n\t\t\t\t\t\t(d) => DOC_LOOKUP[d]?.label || d\n\t\t\t\t\t);\n\t\t\t\t\tgroupLabels[key] = `Shared: ${names.join(\" & \")}`;\n\t\t\t\t}\n\t\t\t\tlocalSharedGroups[key].push(questionId);\n\t\t\t} else {\n\t\t\t\t// The attribute is visible in EXACTLY 1 selected doc.\n\t\t\t\tconst docId = visibleDocs[0];\n\n\t\t\t\tif (allDocKeys.length === 1) {\n\t\t\t\t\t// CATEGORY B: TRULY UNIQUE\n\t\t\t\t\t// It only exists in this doc, period.\n\t\t\t\t\tuniqueMap[docId].push(questionId);\n\t\t\t\t} else {\n\t\t\t\t\t// CATEGORY C: GLOBAL SHARED (Other Shared Factors)\n\t\t\t\t\t// It is visible in 1 doc, but exists in other hidden docs.\n\t\t\t\t\t// We create a group key based on the FULL intersection to show who it's shared with.\n\t\t\t\t\tallDocKeys.sort();\n\t\t\t\t\tconst key = allDocKeys.join(\"|\");\n\n\t\t\t\t\tif (!globalSharedGroups[key]) {\n\t\t\t\t\t\tglobalSharedGroups[key] = [];\n\t\t\t\t\t\tconst names = allDocKeys.map(\n\t\t\t\t\t\t\t(d) => DOC_LOOKUP[d]?.label || d\n\t\t\t\t\t\t);\n\t\t\t\t\t\tgroupLabels[key] = `Shared (Hidden): ${names.join(\n\t\t\t\t\t\t\t\" & \"\n\t\t\t\t\t\t)}`;\n\t\t\t\t\t}\n\t\t\t\t\tglobalSharedGroups[key].push(questionId);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Combine keys for the \"Synthetic Docs\" whitelist so clicking works for both types\n\t\tconst localKeys = Object.keys(localSharedGroups);\n\t\tconst globalKeys = Object.keys(globalSharedGroups);\n\t\tconst syntheticDocs = [...localKeys, ...globalKeys];\n\n\t\treturn {\n\t\t\tuniqueMap,\n\t\t\tlocalSharedGroups,\n\t\t\tglobalSharedGroups,\n\t\t\tsyntheticDocs,\n\t\t\tgroupLabels,\n\t\t};\n\t}, [selectedDocs]);\n};\nexport {\n\tuseAnalysisContext,\n\tID_COLORS,\n\tDOC_THEME_COLORS,\n\tuseDataCategorization,\n\tflattenRanges,\n\tRAW_ANALYSIS,\n\tAnalysisCTX,\n\tuseAnalysisState,\n\tDOC_LOOKUP,\n};\n","// client/src/pages/dpo-tool/CSS_Markdown/CSSMarkdown.tsx\n\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport { ArcScrollWheel } from \"../../demo/DemoPage\";\nimport {\n\tdocHeaderStyle,\n\tdocumentSplitStyle,\n\tDocColumnWrapperStyle,\n\tUniqueAttrsHeadingStyle,\n\tGridMessageStyle,\n\tClearButtonWrapperStyle,\n\tEmptyStateStyle,\n\tcategoryButtonStyle,\n\tSharedFooterStyle,\n\tContentHeaderStyle,\n\tDropDownInputStyle,\n\tattrsAreaStyle,\n\tsectionHeaderStyle,\n\tSharedItemsWrapperStyle,\n\tClearButtonStyle,\n\tSelectorButtonStyle,\n\tMainContainerStyle,\n\tTopControlBarStyle,\n\tContentAreaStyle,\n\tDropdownWrapperStyle,\n\tDropdownMenuStyle,\n\tdropdownItemStyle,\n\tSelectLabelStyle,\n\tdynamicHighlightStyles,\n\tDropDownIconStyle,\n\tUniqueContainerAreaStyle,\n} from \"./CSSMarkdown.styles\";\nimport { styleObjectToString } from \"../../../styles\";\n\nimport {\n\tTDocId,\n\tTHighlightId,\n\tICategoryButtonProps,\n} from \"./CSSMarkdown.types\";\nimport {\n\tuseAnalysisContext,\n\tID_COLORS,\n\tDOC_THEME_COLORS,\n\tuseDataCategorization,\n\tflattenRanges,\n\tRAW_ANALYSIS,\n\tAnalysisCTX,\n\tuseAnalysisState,\n\tDOC_LOOKUP,\n} from \"./mardown-viewer/DataUtils\";\nimport { MarkdownViewer, toCssClass } from \"./mardown-viewer/MarkDownViewer\";\n\nexport const useScrollFloor = () =>\n\t//   ref: RefObject<HTMLElement | null>,\n\t{};\nconst useAutoScroll = (containerRef: React.RefObject<HTMLDivElement>) => {\n\tconst { scrollToId } = useAnalysisContext();\n\n\tuseEffect(() => {\n\t\tif (!scrollToId || !containerRef.current) return;\n\n\t\tconst container = containerRef.current;\n\t\t// const t=container.getElementsByClassName\n\t\tconst target = container.querySelector(\n\t\t\t`.${toCssClass(scrollToId)}`\n\t\t) as HTMLElement;\n\n\t\tif (target) {\n\t\t\tconst containerRect = container.getBoundingClientRect();\n\t\t\tconst targetRect = target.getBoundingClientRect();\n\t\t\tconst relativeTop = targetRect.top - containerRect.top;\n\t\t\tconst currentScroll = container.scrollTop;\n\t\t\tconst centerOffset =\n\t\t\t\tcontainerRect.height / 2 - targetRect.height / 2;\n\t\t\tconst scrollPos = currentScroll + relativeTop - centerOffset;\n\n\t\t\tcontainer.scrollTo({\n\t\t\t\ttop: scrollPos,\n\t\t\t\tbehavior: \"smooth\",\n\t\t\t});\n\t\t}\n\t}, [scrollToId, containerRef]);\n};\n\nconst useDynamicStyles = () => {\n\tconst { activeIds } = useAnalysisContext();\n\n\tconst highlightRules = useMemo(\n\t\t() => dynamicHighlightStyles(activeIds, ID_COLORS),\n\t\t[activeIds]\n\t);\n\n\treturn useMemo(() => styleObjectToString(highlightRules), [highlightRules]);\n};\n\nconst useDropdownBehavior = (\n\tisOpen: boolean,\n\tsetIsOpen: (v: boolean) => void\n) => {\n\tconst ref = useRef<HTMLDivElement>(null);\n\tuseEffect(() => {\n\t\tfunction handleClickOutside(event: MouseEvent) {\n\t\t\tif (\n\t\t\t\tisOpen &&\n\t\t\t\tref.current &&\n\t\t\t\t!ref.current.contains(event.target as Element)\n\t\t\t) {\n\t\t\t\tsetIsOpen(false);\n\t\t\t}\n\t\t}\n\t\tdocument.addEventListener(\"mousedown\", handleClickOutside);\n\t\treturn () =>\n\t\t\tdocument.removeEventListener(\"mousedown\", handleClickOutside);\n\t}, [isOpen, setIsOpen]);\n\n\treturn ref;\n};\n\n// --- Components ---\n\nconst CategoryButton: React.FC<ICategoryButtonProps> = ({\n\tid,\n\tStyleOverrides = {},\n}) => {\n\tconst { activeIds, toggleId } = useAnalysisContext();\n\tconst isActive = activeIds.includes(id);\n\tconst color = ID_COLORS[id] || \"#ccc\";\n\treturn (\n\t\t<button\n\t\t\tonClick={() => toggleId(id)}\n\t\t\tclassName={WATCHED_CLASS}\n\t\t\tstyle={categoryButtonStyle(isActive, color, StyleOverrides)}\n\t\t>\n\t\t\t{id}\n\t\t</button>\n\t\t// <p>Test El</p>\n\t);\n};\nconst EmptyState: React.FC<{ message?: string }> = ({ message = \"None\" }) => (\n\t<div style={EmptyStateStyle}>{message}</div>\n);\n\nconst WATCHED_CLASS: string = \"unique-section-header\";\n\nconst useClicker = () => {\n\tconst { toggleActiveDoc } = useAnalysisContext();\n\tuseEffect(() => {\n\t\tconst handleGlobalClick = (event: MouseEvent): void => {\n\t\t\tconst clickedElement = event.target as HTMLElement;\n\t\t\tconst clickedWatchedDiv: boolean =\n\t\t\t\tclickedElement?.classList?.contains(WATCHED_CLASS) ?? false;\n\t\t\tif (!clickedWatchedDiv) {\n\t\t\t\ttoggleActiveDoc(null)();\n\t\t\t} else {\n\t\t\t}\n\t\t};\n\t\tdocument.addEventListener(\"click\", handleGlobalClick);\n\t\treturn (): void => {\n\t\t\tdocument.removeEventListener(\"click\", handleGlobalClick);\n\t\t};\n\t}, []);\n};\nconst SectionHeaderAlt: React.FC<{\n\tlabel: string;\n\tcolor?: string;\n\tStyleOverrides?: React.CSSProperties;\n\tcolumns: number;\n}> = ({ label, color = \"#ccc\", StyleOverrides = {}, columns }) => {\n\treturn (\n\t\t<div style={sectionHeaderStyle(color, StyleOverrides, columns)}>\n\t\t\t{label}\n\t\t</div>\n\t);\n};\nconst AttributeList: React.FC<{\n\tids: THighlightId[];\n\tcolumns: number;\n}> = ({ ids, columns }) => {\n\treturn (\n\t\t<div style={attrsAreaStyle(columns)}>\n\t\t\t{ids.length === 0 ? (\n\t\t\t\t<EmptyState />\n\t\t\t) : (\n\t\t\t\tids.map((id) => (\n\t\t\t\t\t<CategoryButton\n\t\t\t\t\t\tkey={id}\n\t\t\t\t\t\tid={id}\n\t\t\t\t\t/>\n\t\t\t\t))\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\nconst SidebarUniqueSection: React.FC<{\n\tdocId: TDocId;\n}> = ({ docId }) => {\n\tconst themeColor = DOC_THEME_COLORS[docId] || \"#ccc\";\n\tconst { selectedDocs } = useAnalysisContext();\n\tconst columns = selectedDocs.length;\n\n\treturn (\n\t\t<SectionHeader\n\t\t\tdocId={docId}\n\t\t\tcolor={themeColor}\n\t\t\tcolumns={columns}\n\t\t/>\n\t);\n};\nconst UniqueAttrsHeading: React.FC = () => (\n\t<div style={UniqueAttrsHeadingStyle}>Unique Attributes</div>\n);\n// type T=Parameters<Element[\"scrollTo\"]>\nconst useScrollCenter = (containerRef: React.RefObject<HTMLDivElement>) => {\n\tconst { activeDoc, selectedDocs } = useAnalysisContext();\n\tconst [_selectedDocs, _setSelectedDocs] = useState(\n\t\t() => !(selectedDocs === undefined || selectedDocs.length === 0)\n\t);\n\n\tuseEffect(() => {\n\t\tif (!activeDoc || !containerRef.current) return;\n\n\t\tconst container = containerRef.current;\n\t\tconst target = document.getElementById(\n\t\t\t`#${activeDoc}_scroll`\n\t\t) as HTMLElement;\n\n\t\tif (target) {\n\t\t\tconst containerRect = container.getBoundingClientRect();\n\t\t\tconst targetRect = target.getBoundingClientRect();\n\t\t\tconst relativeTop = targetRect.top - containerRect.top;\n\t\t\tconst currentScroll = container.scrollTop;\n\t\t\tconst centerOffset =\n\t\t\t\tcontainerRect.height / 2 - targetRect.height / 2;\n\t\t\tconst scrollPos = currentScroll + relativeTop - centerOffset;\n\n\t\t\tcontainer.scrollTo({\n\t\t\t\ttop: scrollPos,\n\t\t\t\tbehavior: \"smooth\",\n\t\t\t});\n\t\t}\n\t}, [activeDoc, containerRef]);\n\tuseEffect(() => {\n\t\tif (!containerRef.current) return;\n\t\tconst container = containerRef.current;\n\n\t\tconst containerRect = container.getBoundingClientRect();\n\t\tconst centerOffset = containerRect.height;\n\t\t_setSelectedDocs((prev) => {\n\t\t\tif (prev === false) {\n\t\t\t\tif (selectedDocs && selectedDocs?.length !== 0) {\n\t\t\t\t\tcontainer.scrollTo({\n\t\t\t\t\t\ttop: centerOffset,\n\t\t\t\t\t\tbehavior: \"instant\",\n\t\t\t\t\t});\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (selectedDocs === undefined || selectedDocs?.length === 0) {\n\t\t\t\t\tcontainer.scrollTo({\n\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\tbehavior: \"instant\",\n\t\t\t\t\t});\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn prev;\n\t\t});\n\t}, [selectedDocs, containerRef]);\n\n\tconst hasExceededRef = useRef(false);\n\n\tuseEffect(() => {\n\t\tconst container = containerRef.current;\n\t\tconst containerRect = container.getBoundingClientRect();\n\t\tconst limit = containerRect.height;\n\t\tif (!container) return;\n\n\t\tconst handleWheel = (e: WheelEvent) => {\n\t\t\tif (!hasExceededRef.current) {\n\t\t\t\tif (container.scrollTop > limit * 0.9) {\n\t\t\t\t\thasExceededRef.current = true;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (container.scrollTop <= limit && e.deltaY < 0) {\n\t\t\t\te.preventDefault();\n\t\t\t\tcontainer.scrollTo({\n\t\t\t\t\ttop: limit,\n\t\t\t\t\tbehavior: \"instant\",\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tcontainer.addEventListener(\"wheel\", handleWheel, { passive: false });\n\n\t\treturn () => {\n\t\t\tcontainer.removeEventListener(\"wheel\", handleWheel);\n\t\t};\n\t});\n};\nconst SectionHeader: React.FC<{\n\tdocId: string;\n\tcolor?: string;\n\tStyleOverrides?: React.CSSProperties;\n\tcolumns: number;\n\tlabel?: string; // Add this optional prop\n}> = ({ docId, color = \"#ccc\", StyleOverrides = {}, columns, label }) => {\n\tconst { toggleActiveDoc } = useAnalysisContext();\n\t// const formattedLabel = `Unique to ${DOC_LOOKUP[docId].label}`;\n\tconst displayLabel =\n\t\tlabel ||\n\t\t(DOC_LOOKUP[docId] ? `Unique to ${DOC_LOOKUP[docId].label}` : docId);\n\treturn (\n\t\t<div\n\t\t\tstyle={sectionHeaderStyle(color, StyleOverrides, columns)}\n\t\t\tclassName={`${WATCHED_CLASS}`}\n\t\t\tid={`#${docId}_scroll`}\n\t\t\tonClick={() => {\n\t\t\t\ttoggleActiveDoc(docId)();\n\t\t\t}}\n\t\t>\n\t\t\t{displayLabel}\n\t\t</div>\n\t);\n};\n// const UniqueAttrsSidebar: React.FC = () => {\n// \tconst { uniqueMap, sharedMap, sharedList } = useDataCategorization();\n// \tconst { selectedDocs, setSyntheticDocs } = useAnalysisContext();\n\n// \tconst scrollRef = useRef<HTMLDivElement>(null);\n// \tuseEffect(() => {\n// \t\tsetSyntheticDocs(syntheticDocs);\n// \t}, [syntheticDocs, setSyntheticDocs]);\n// \t/**\n// \t\t## Shared with Policy A,B,C  // Local Shared\n// \t\t\t...\n// \t\t## Shared with Policy A,B\n// \t\t\t... {Not in A,B,C}\n// \t\t## Shared with Policy A,C\n// \t\t\t... {Not in A,B,C}\n// \t\t## Shared with Policy B,C\n// \t\t\t... {Not in A,B,C}\n// \t\t// if popped from sharedMap, remaining are  ` Global Shared`\n// \t\t## Other Shared Factors  // Global Shared\n// \t\t\t... Display remaining shared, Shared between TDocId[]\n\n// \t */\n\n// \t// Object.entries(sharedMap).forEach(([questionId, docList]) => {\n\n// \t// \t});\n\n// \tuseScrollCenter(scrollRef as any);\n// \treturn (\n// \t\t<div\n// \t\t\tstyle={UniqueContainerAreaStyle}\n// \t\t\tref={scrollRef}\n// \t\t>\n// \t\t\t<div\n// \t\t\t\tstyle={{\n// \t\t\t\t\theight: \"100%\",\n// \t\t\t\t}}\n// \t\t\t>\n// \t\t\t\t<EmptyState message=\"No documents selected\" />\n// \t\t\t</div>\n\n// \t\t\t{selectedDocs.length > 0 && (\n// \t\t\t\t<>\n// \t\t\t\t\t<EmptyState message=\"Unique Attributes\" />\n// \t\t\t\t\t{Object.entries(uniqueMap).map(([docId]) => (\n// \t\t\t\t\t\t<SidebarUniqueSection\n// \t\t\t\t\t\t\tkey={docId}\n// \t\t\t\t\t\t\tdocId={docId}\n// \t\t\t\t\t\t/>\n// \t\t\t\t\t))}\n// \t\t\t\t</>\n// \t\t\t)}\n// \t\t\t{sharedList.length > 0 && (\n// \t\t\t\t<>\n// \t\t\t\t\t<EmptyState message=\"Shared Attributes\" />\n// \t\t\t\t\t{/*\n// \t\t\t\t\t\tSImilar to SidebarUniqueSection above, However we will need a new onclick handler, a generated title from the combination,\n// \t\t\t\t\t\tThen a similar scroll to center onclick mechanic, AttributeList for the corresponding list wrapped in ArcScrollWheel\n\n// \t\t\t\t\t\tIf global shared then (not in selectedDocs) add <EmptyState message=\"Shared Attributes\" /> and similarly iterate with new buttons\n\n// \t\t\t\t */}\n// \t\t\t\t</>\n// \t\t\t)}\n// \t\t\t<div style={{ height: \"100%\" }} />\n// \t\t</div>\n// \t);\n// };\n// CSSMarkdown.tsx\n\nconst SidebarSharedSection: React.FC<{\n\tgroupKey: string;\n\tlabel: string;\n\tcolor: string;\n}> = ({ groupKey, label }) => {\n\tconst { selectedDocs } = useAnalysisContext();\n\t// For Global shared, we might want columns=1, but for Local, match selectedDocs\n\tconst columns = selectedDocs.length;\n\n\treturn (\n\t\t<SectionHeader\n\t\t\tdocId={groupKey}\n\t\t\tlabel={label} // <--- Passing the nice label here\n\t\t\t// color={color}\n\t\t\tcolumns={columns}\n\t\t/>\n\t);\n};\n\nconst UniqueAttrsSidebar: React.FC = () => {\n\tconst {\n\t\tuniqueMap,\n\t\tlocalSharedGroups,\n\t\tglobalSharedGroups,\n\t\tsyntheticDocs,\n\t\tgroupLabels,\n\t} = useDataCategorization();\n\n\tconst { selectedDocs, setSyntheticDocs } = useAnalysisContext();\n\tconst scrollRef = useRef<HTMLDivElement>(null);\n\n\t// Sync valid click targets to Context\n\tuseEffect(() => {\n\t\tsetSyntheticDocs(syntheticDocs);\n\t}, [syntheticDocs, setSyntheticDocs]);\n\n\tuseScrollCenter(scrollRef as any);\n\n\tconst hasSelection = selectedDocs.length > 0;\n\tconst hasLocal = Object.keys(localSharedGroups).length > 0;\n\tconst hasGlobal = Object.keys(globalSharedGroups).length > 0;\n\n\treturn (\n\t\t<div\n\t\t\tstyle={UniqueContainerAreaStyle}\n\t\t\tref={scrollRef}\n\t\t>\n\t\t\t<div style={{ height: \"100%\" }}>\n\t\t\t\t<EmptyState\n\t\t\t\t\tmessage={!hasSelection ? \"No documents selected\" : \"\"}\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t{hasSelection && (\n\t\t\t\t<>\n\t\t\t\t\t{/* 1. UNIQUE ATTRIBUTES */}\n\t\t\t\t\t<EmptyState message=\"Unique Attributes\" />\n\t\t\t\t\t{Object.entries(uniqueMap).map(([docId]) => (\n\t\t\t\t\t\t<SidebarUniqueSection\n\t\t\t\t\t\t\tkey={docId}\n\t\t\t\t\t\t\tdocId={docId}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))}\n\n\t\t\t\t\t{/* 2. LOCAL SHARED (Shared between A & B) */}\n\t\t\t\t\t{hasLocal && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<EmptyState message=\"Shared Attributes\" />\n\t\t\t\t\t\t\t{Object.keys(localSharedGroups).map((key) => (\n\t\t\t\t\t\t\t\t<SidebarSharedSection\n\t\t\t\t\t\t\t\t\tkey={key}\n\t\t\t\t\t\t\t\t\tgroupKey={key}\n\t\t\t\t\t\t\t\t\tlabel={groupLabels[key]}\n\t\t\t\t\t\t\t\t\tcolor=\"#2563eb\" // Blue\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* 3. GLOBAL SHARED (Shared with C, D...) */}\n\t\t\t\t\t{hasGlobal && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<EmptyState message=\"Other Shared Factors\" />\n\t\t\t\t\t\t\t{Object.keys(globalSharedGroups).map((key) => (\n\t\t\t\t\t\t\t\t<SidebarSharedSection\n\t\t\t\t\t\t\t\t\tkey={key}\n\t\t\t\t\t\t\t\t\tgroupKey={key}\n\t\t\t\t\t\t\t\t\tlabel={groupLabels[key]}\n\t\t\t\t\t\t\t\t\tcolor=\"#9333ea\" // Purple (to differentiate)\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</>\n\t\t\t)}\n\n\t\t\t<div style={{ height: \"100%\" }} />\n\t\t</div>\n\t);\n};\n\nconst DropdownItemList: React.FC = () => {\n\tconst { selectedDocs, toggleDoc } = useAnalysisContext();\n\treturn (\n\t\t<div style={DropdownMenuStyle}>\n\t\t\t{Object.keys(DOC_LOOKUP).map((docId) => {\n\t\t\t\tconst isSelected = selectedDocs.includes(docId);\n\t\t\t\treturn (\n\t\t\t\t\t<div\n\t\t\t\t\t\tkey={docId}\n\t\t\t\t\t\tstyle={dropdownItemStyle(isSelected)}\n\t\t\t\t\t\tonClick={() => toggleDoc(docId)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\tchecked={isSelected}\n\t\t\t\t\t\t\treadOnly\n\t\t\t\t\t\t\tstyle={DropDownInputStyle}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/* USE LOOKUP for Label */}\n\t\t\t\t\t\t{DOC_LOOKUP[docId].label}\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t})}\n\t\t</div>\n\t);\n};\n\nconst DocumentSelectorDropdown: React.FC = () => {\n\tconst { selectedDocs, isDropdownOpen, setIsDropdownOpen } =\n\t\tuseAnalysisContext();\n\tconst dropdownRef = useDropdownBehavior(isDropdownOpen, setIsDropdownOpen);\n\n\treturn (\n\t\t<div\n\t\t\tstyle={DropdownWrapperStyle}\n\t\t\tref={dropdownRef}\n\t\t>\n\t\t\t<button\n\t\t\t\tstyle={SelectorButtonStyle}\n\t\t\t\tonClick={() => setIsDropdownOpen(!isDropdownOpen)}\n\t\t\t>\n\t\t\t\t<span>\n\t\t\t\t\t{selectedDocs.length === 0\n\t\t\t\t\t\t? \"Select...\"\n\t\t\t\t\t\t: `${selectedDocs.length} Selected`}\n\t\t\t\t</span>\n\t\t\t\t<span style={DropDownIconStyle}></span>\n\t\t\t</button>\n\n\t\t\t{isDropdownOpen && <DropdownItemList />}\n\t\t</div>\n\t);\n};\n\nconst AnalysisTopBar: React.FC = () => {\n\tconst { setActiveIds } = useAnalysisContext();\n\treturn (\n\t\t<div style={TopControlBarStyle}>\n\t\t\t<label style={SelectLabelStyle}>Select Documents:</label>\n\t\t\t<DocumentSelectorDropdown />\n\t\t\t<div style={ClearButtonWrapperStyle}>\n\t\t\t\t<button\n\t\t\t\t\tonClick={() => setActiveIds([])}\n\t\t\t\t\tstyle={ClearButtonStyle}\n\t\t\t\t>\n\t\t\t\t\tClear Highlights\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\n//  <div style={documentSplitStyle(columns)}></div>\nconst DocumentHeader: React.FC<{ docId: TDocId }> = ({ docId }) => {\n\tconst themeColor = DOC_THEME_COLORS[docId] || \"#ccc\";\n\n\treturn (\n\t\t<div style={docHeaderStyle(themeColor)}>{DOC_LOOKUP[docId].label}</div>\n\t);\n};\nconst DocumentGridHeading: React.FC = () => {\n\tconst { selectedDocs } = useAnalysisContext();\n\n\tconst columns = selectedDocs.length;\n\treturn (\n\t\t<div style={documentSplitStyle(\"SPLIT\", columns)}>\n\t\t\t{selectedDocs.length === 0 ? (\n\t\t\t\t<div style={GridMessageStyle}>None</div>\n\t\t\t) : (\n\t\t\t\tselectedDocs.map((docId) => <DocumentHeader docId={docId} />)\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\nconst DocumentColumn: React.FC<{ docId: TDocId }> = ({ docId }) => {\n\tconst content = DOC_LOOKUP[docId].content;\n\n\tconst segments = useMemo(() => flattenRanges(docId, RAW_ANALYSIS), [docId]);\n\n\tconst scrollRef = useRef<HTMLDivElement>(null);\n\tuseAutoScroll(scrollRef as any);\n\n\treturn (\n\t\t<div\n\t\t\tstyle={DocColumnWrapperStyle}\n\t\t\tref={scrollRef}\n\t\t>\n\t\t\t{/* 2. Use the memoized component here */}\n\t\t\t{/* <p>Test Doc</p> */}\n\t\t\t<MarkdownViewer\n\t\t\t\tcontent={content}\n\t\t\t\tsegments={segments}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n\nconst DocumentGrid: React.FC = () => {\n\tconst { selectedDocs } = useAnalysisContext();\n\n\tconst columns = selectedDocs.length;\n\treturn (\n\t\t<div style={documentSplitStyle(\"SPLIT\", columns)}>\n\t\t\t{selectedDocs.length === 0 ? (\n\t\t\t\t<div style={GridMessageStyle}>Please select a document.</div>\n\t\t\t) : (\n\t\t\t\tselectedDocs.map((docId) => (\n\t\t\t\t\t<DocumentColumn\n\t\t\t\t\t\tkey={docId}\n\t\t\t\t\t\tdocId={docId}\n\t\t\t\t\t/>\n\t\t\t\t))\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\nconst AnalysisStyler: React.FC = () => <style>{useDynamicStyles()}</style>;\nconst useFixedRemainingHeight = () => {\n\tconst element_ref = useRef<HTMLDivElement>(null);\n\n\tconst [height_available, setHeightAvailable] = useState<string>(\"\");\n\n\t// Ref to store the initial top position, which will be constant for the calculation\n\tconst initial_top_ref = useRef<number | null>(null);\n\n\tconst calculateHeight = () => {\n\t\tif (element_ref.current) {\n\t\t\tconst rect = element_ref.current.getBoundingClientRect();\n\n\t\t\tif (initial_top_ref.current === null) {\n\t\t\t\tinitial_top_ref.current = rect.top;\n\t\t\t}\n\n\t\t\tconst fixed_element_top = initial_top_ref.current;\n\n\t\t\tconst viewport_height = window.innerHeight;\n\n\t\t\tconst remaining_height = viewport_height - fixed_element_top;\n\n\t\t\tsetHeightAvailable(`${remaining_height}px`);\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tcalculateHeight();\n\n\t\twindow.addEventListener(\"resize\", calculateHeight);\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"resize\", calculateHeight);\n\t\t};\n\t}, []);\n\n\treturn { element_ref, height_available };\n};\n\nconst AnalysisSpinner: React.FC = () => {\n\t// const { uniqueMap } = useDataCategorization();\n\t// const { activeDoc } = useAnalysisContext();\n\t// if (activeDoc === null) return null;\n\t// const ids = uniqueMap[activeDoc];\n\t// const buttons = ids.map((id) => (\n\t// \t<CategoryButton\n\t// \t\tkey={id}\n\t// \t\tid={id}\n\t// \t/>\n\t// ));\n\tconst { uniqueMap, localSharedGroups, globalSharedGroups } =\n\t\tuseDataCategorization();\n\tconst { activeDoc } = useAnalysisContext();\n\n\tif (activeDoc === null) return null;\n\n\t// Check all 3 maps for the ID\n\tconst ids =\n\t\tuniqueMap[activeDoc] ||\n\t\tlocalSharedGroups[activeDoc] ||\n\t\tglobalSharedGroups[activeDoc] ||\n\t\t[];\n\n\tif (ids.length === 0) return null;\n\n\tconst buttons = ids.map((id) => (\n\t\t<CategoryButton\n\t\t\tkey={id}\n\t\t\tid={id}\n\t\t/>\n\t));\n\treturn (\n\t\t<div\n\t\t\tstyle={{\n\t\t\t\tposition: \"absolute\",\n\t\t\t\theight: `calc(${CONFIG.radius + CONFIG.itemHeight}vh)`,\n\t\t\t\twidth: `calc(${CONFIG.radius / 2 + CONFIG.itemWidth / 2}vh)`,\n\t\t\t\tzIndex: 300,\n\t\t\t}}\n\t\t>\n\t\t\t<ArcScrollWheel\n\t\t\t\titems={buttons}\n\t\t\t\tinitial_rotation={90}\n\t\t\t/>\n\t\t</div>\n\t);\n};\nimport { CONFIG } from \"../../demo/DemoPage\";\nconst AnalysisContainer: React.FC = () => {\n\tuseClicker();\n\treturn (\n\t\t<>\n\t\t\t<AnalysisSpinner />\n\n\t\t\t<div style={ContentHeaderStyle}>\n\t\t\t\t<UniqueAttrsHeading />\n\t\t\t\t<DocumentGridHeading />\n\t\t\t</div>\n\t\t\t<div style={ContentAreaStyle}>\n\t\t\t\t<UniqueAttrsSidebar />\n\n\t\t\t\t<DocumentGrid />\n\t\t\t</div>\n\t\t</>\n\t);\n};\nconst DocumentAnalysisViewer: React.FC = () => {\n\tconst { element_ref, height_available } = useFixedRemainingHeight();\n\n\treturn (\n\t\t<AnalysisCTX value={useAnalysisState()}>\n\t\t\t<AnalysisStyler />\n\n\t\t\t<div\n\t\t\t\tstyle={MainContainerStyle(height_available)}\n\t\t\t\tclassName=\"no-aos\"\n\t\t\t\tref={element_ref}\n\t\t\t>\n\t\t\t\t<AnalysisTopBar />\n\t\t\t\t<AnalysisContainer />\n\t\t\t\t{/* <SharedAttrsFooter /> */}\n\t\t\t</div>\n\t\t</AnalysisCTX>\n\t);\n};\n\nexport { DocumentAnalysisViewer };\n","import { DocumentAnalysisViewer } from \"./CSS_Markdown/CSSMarkdown\";\nconst F = () => <DocumentAnalysisViewer />;\nexport default F;\n","// client/src/pages/demo/DemoPage.tsx\n\n// client/src/pages/demo/DemoPage.tsx\n\nimport React, {\n\tcreateContext,\n\tuseContext,\n\tuseEffect,\n\tuseRef,\n\tuseState,\n} from \"react\";\n// import { DocumentAnalysisViewer } from \"../dpo-tool/css_dual\";\nimport { DocumentAnalysisViewer } from \"../dpo-tool/CSS_Markdown/CSSMarkdown\";\nimport { ExperimentScene } from \"./DemoCube\";\n\n// import { DocumentAnalysisViewer } from \"../dpo-tool/dual\";\nexport const CONFIG = {\n\titemHeight: 10,\n\titemWidth: 15,\n\tradius: 70,\n\tcontainerHeightRatio: 1,\n};\n\nconst TestFC = () => <>T</>;\nconst DemoComponents = [\n\t<TestFC />,\n\t<TestFC />,\n\t<TestFC />,\n\t<TestFC />,\n\t<TestFC />,\n\t<TestFC />,\n\t<TestFC />,\n\t<TestFC />,\n];\n\nconst getContainerStyle = (): React.CSSProperties => ({\n\tposition: \"fixed\",\n\twidth: \"100%\",\n\toverflow: \"visible\",\n\n\theight: \"100%\",\n});\n\nconst container_style: React.CSSProperties = {\n\theight: `calc(${100}%)`,\n\taspectRatio: \"1\",\n\toverflow: \"visible\",\n};\nconst getItemStyle = (\n\tmarginTop: number,\n\tmarginLeft: number,\n\tz_score: number,\n\n\topacity_function: (z_score: number) => number\n): React.CSSProperties => ({\n\tposition: \"absolute\",\n\n\theight: `${CONFIG.itemHeight}vh`,\n\twidth: `${CONFIG.itemWidth}vh`,\n\tdisplay: \"flex\",\n\tmarginTop: `${marginTop}vh`,\n\t// transform: `translateY(${marginTop - CONFIG.itemHeight / 2}%)`, // doesnt work since its now wrt to item height\n\tmarginLeft: `calc(${marginLeft - CONFIG.itemWidth / 2}vh)`,\n\n\ttextAlign: \"center\",\n\tjustifyContent: \"center\",\n\talignItems: \"center\",\n\n\topacity: opacity_function(z_score),\n\tvisibility: opacity_function(z_score) > 0 ? \"visible\" : \"hidden\",\n\t// background: \"red\",\n\tcolor: \"#ffffff\",\n\tzIndex: 200 + z_score,\n\toverflow: \"visible\",\n});\n\nconst getHelperLineStyle = (): React.CSSProperties => ({\n\tposition: \"absolute\",\n\tleft: 0,\n\twidth: \"100%\",\n\theight: \"1px\",\n\t// background: \"red\",\n\topacity: 0.3,\n});\n\ninterface WheelItemProps {\n\tComponent: React.ReactNode;\n\tindex: number;\n}\n\ninterface ScrollWheelProps {\n\titems: React.ReactNode[];\n}\nexport const opacityFunc = (z_score: number) =>\n\tMath.floor(z_score / (2 * Math.PI)) === 0 ? Math.sin(z_score) : 0;\nconst WheelItem: React.FC<WheelItemProps> = ({ Component, index }) => {\n\tconst { rotation, opacity_function, total_items } =\n\t\tuseContext(ScrollWheelContext);\n\tconst theta =\n\t\t2 *\n\t\tMath.asin(\n\t\t\tMath.sqrt(CONFIG.itemHeight ** 2 + CONFIG.itemWidth ** 2) /\n\t\t\t\tCONFIG.radius\n\t\t);\n\t// testing minimal distance\n\tconst items_per_half_turn = Math.PI / theta;\n\t// const total_items = 31;\n\tconst total_turns = Math.floor(total_items / (items_per_half_turn * 2)) + 1;\n\t// const theta = Math.PI / items_per_half_turn;\n\n\tconst current_angle = theta * -index + rotation;\n\tconst z_score = current_angle % (2 * Math.PI * total_turns);\n\t// const opacity_score =\n\t// \tMath.floor(z_score / (2 * Math.PI)) === 0 ? Math.sin(z_score) : 0;\n\tconst factor = CONFIG.radius / 2;\n\tconst marginLeft = 1 * Math.sin(current_angle) * factor; // ASSUME SQUARE FOR NOW\n\tconst marginTop = (1 - 1 * Math.cos(current_angle)) * factor;\n\tconst style = getItemStyle(\n\t\tmarginTop,\n\t\tmarginLeft,\n\t\tz_score,\n\t\topacity_function\n\t);\n\n\treturn (\n\t\t<div\n\t\t\tstyle={style}\n\t\t\t// onClick={() => setIsActive(!isActive)}\n\t\t>\n\t\t\t<div\n\t\t\t\tstyle={{ height: \"unset\", width: \"unset\", overflow: \"visible\" }}\n\t\t\t>\n\t\t\t\t{Component}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\nconst ScrollWheelContext = createContext({\n\trotation: 0,\n\ttotal_items: 0,\n\topacity_function: opacityFunc,\n});\n\nconst useScrollController = (initial_rotation = 0) => {\n\tconst [rotation, setRotation] = useState(\n\t\t() => (initial_rotation * Math.PI) / 180\n\t);\n\tconst ref = useRef<HTMLDivElement>(null);\n\n\tuseEffect(() => {\n\t\tconst element = ref.current;\n\t\tif (!element) return;\n\n\t\tconst handleWheel = (e: WheelEvent) => {\n\t\t\te.preventDefault();\n\t\t\tconst innerHeight = window.innerHeight;\n\t\t\tconst delta_y = e.deltaY;\n\t\t\tconst tangent_distance = innerHeight / 2 / 2;\n\n\t\t\tconst delta_theta = Math.atan(delta_y / tangent_distance);\n\n\t\t\tsetRotation((prev) => prev + delta_theta);\n\t\t};\n\n\t\telement.addEventListener(\"wheel\", handleWheel, { passive: false });\n\n\t\treturn () => {\n\t\t\telement.removeEventListener(\"wheel\", handleWheel);\n\t\t};\n\t}, []);\n\n\treturn { rotation, ref };\n};\n\ninterface ScrollWheelProps {\n\titems: React.ReactNode[];\n\tinitial_rotation?: number;\n\topacity_function?: (z_score: number) => number;\n}\nconst ArcScrollWheel: React.FC<ScrollWheelProps> = ({\n\titems,\n\tinitial_rotation = 0,\n\topacity_function = opacityFunc,\n}) => {\n\tconst containerStyle = getContainerStyle();\n\tconst helperLineStyle = getHelperLineStyle();\n\tconst total_items = items.length;\n\tconst { rotation, ref } = useScrollController(initial_rotation);\n\n\treturn (\n\t\t<ScrollWheelContext\n\t\t\tvalue={{\n\t\t\t\trotation,\n\t\t\t\ttotal_items,\n\t\t\t\topacity_function,\n\t\t\t}}\n\t\t>\n\t\t\t<div\n\t\t\t\tstyle={container_style}\n\t\t\t\tclassName=\"no-aos\"\n\t\t\t\tonMouseLeave={() => console.log(\"left\")}\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tstyle={containerStyle}\n\t\t\t\t\tref={ref}\n\t\t\t\t>\n\t\t\t\t\t{items.map((Comp, i) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<WheelItem\n\t\t\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\t\t\tComponent={Comp}\n\t\t\t\t\t\t\t\tindex={i}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\n\t\t\t\t\t<div style={helperLineStyle} />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</ScrollWheelContext>\n\t);\n};\nconst DemoWheelScroll = () => <ArcScrollWheel items={DemoComponents} />;\nexport { ArcScrollWheel, DemoWheelScroll };\nconst DemoContainer = () => {\n\treturn (\n\t\t<div\n\t\t\tstyle={{\n\t\t\t\theight: `calc(${CONFIG.radius + CONFIG.itemHeight}vh)`,\n\t\t\t\twidth: `calc(${CONFIG.radius / 2 + CONFIG.itemWidth / 2}vh)`,\n\t\t\t}}\n\t\t>\n\t\t\t<ArcScrollWheel items={DemoComponents} />\n\t\t</div>\n\t);\n};\nexport default DemoContainer;\n"],"names":["toCssClass","id","concat","replace","remarkHighlightPlugin","options","tree","segments","length","visit","node","index","parent","undefined","position","textNode","nodeStart","start","offset","nodeEnd","end","relevantSegments","filter","s","newChildren","cursor","seg","sort","a","b","push","type","value","slice","hStart","Math","max","hEnd","min","textContent","classNames","ids","map","join","data","hName","hProperties","className","children","splice","MarkdownViewer","React","_ref","content","_jsx","ReactMarkdown","remarkPlugins","remarkGfm","components","highlight","_ref2","props","_objectWithoutProperties","_excluded","_objectSpread","DropDownIconStyle","DropDownInputStyle","ButtonStyle","border","borderRadius","background","DropdownWrapperStyle","display","width","DropdownMenuStyle","left","top","marginTop","backgroundColor","boxShadow","zIndex","padding","DropdownItemBaseStyle","userSelect","gap","alignItems","dropdownItemStyle","isSelected","SelectorButtonStyle","fontSize","justifyContent","minWidth","ClearButtonWrapperStyle","flexDirection","ClearButtonStyle","marginLeft","EmptyStateStyle","color","GridMessageStyle","margin","categoryButtonStyle","isActive","StyleOverrides","arguments","borderLeft","fontWeight","height","justifySelf","MainContainerStyle","height_available","bgwhite","TopControlBarStyle","borderBottom","SelectLabelStyle","textWrap","CONTENT_GRID_STYLE","gridTemplateColumns","ContentHeaderStyle","minHeight","ContentAreaStyle","maxHeight","documentSplitStyle","columns","DocColumnWrapperStyle","overflow","sectionHeaderStyle","textDecorationLine","textDecorationColor","UniqueContainerAreaStyle","overflowY","borderRight","UniqueAttrsHeadingStyle","textAlign","alignContent","flex","RAW_DOCS","RAW_ANALYSIS","local_question_data","DOC_LOOKUP","Object","entries","forEach","policyName","versions","hash","policy_content","label","fetch_date","ANALYSIS_KEYS","keys","GRADIENT_COLORS","generateGradient","ID_COLORS","key","DOC_HASHES","DOC_COLORS_LIST","DOC_THEME_COLORS","AnalysisCTX","createContext","useAnalysisState","activeIds","setActiveIds","useState","syntheticDocs","setSyntheticDocs","selectedDocs","setSelectedDocs","activeDoc","setActiveDoc","isDropdownOpen","setIsDropdownOpen","scrollToId","setScrollToId","toggleDoc","docId","prev","includes","d","toggleId","isTurningOn","console","log","x","setTimeout","toggleActiveDoc","useAnalysisContext","context","useContext","Error","useDataCategorization","useMemo","uniqueMap","localSharedGroups","globalSharedGroups","groupLabels","_ref4","questionId","docMap","allDocKeys","visibleDocs","docHash","names","_DOC_LOOKUP$d","_DOC_LOOKUP$d2","useDynamicStyles","highlightRules","dynamicHighlightStyles","colorMap","rules","borderColor","safeClassName","styleObjectToString","CategoryButton","onClick","WATCHED_CLASS","style","EmptyState","message","SidebarUniqueSection","_ref5","themeColor","SectionHeader","UniqueAttrsHeading","_ref6","displayLabel","SidebarSharedSection","_ref7","groupKey","UniqueAttrsSidebar","scrollRef","useRef","useEffect","containerRef","_selectedDocs","_setSelectedDocs","current","container","target","document","getElementById","containerRect","getBoundingClientRect","targetRect","relativeTop","scrollPos","scrollTop","scrollTo","behavior","centerOffset","hasExceededRef","limit","handleWheel","e","deltaY","preventDefault","addEventListener","passive","removeEventListener","useScrollCenter","hasSelection","hasLocal","hasGlobal","_jsxs","ref","_Fragment","_ref8","DropdownItemList","checked","readOnly","DocumentSelectorDropdown","isOpen","setIsOpen","dropdownRef","handleClickOutside","event","contains","AnalysisTopBar","DocumentHeader","_ref9","textTransform","letterSpacing","borderTop","DocumentGridHeading","DocumentColumn","_ref0","flattenRanges","points","Set","rangeMap","_ref3","occurrences","instance","substring_indices","add","sortedPoints","Array","from","_loop","i","mid","r","querySelector","useAutoScroll","DocumentGrid","AnalysisStyler","AnalysisSpinner","buttons","CONFIG","radius","itemHeight","itemWidth","ArcScrollWheel","items","initial_rotation","AnalysisContainer","useClicker","handleGlobalClick","_clickedElement$class","_clickedElement$class2","clickedElement","classList","DocumentAnalysisViewer","element_ref","useFixedRemainingHeight","setHeightAvailable","initial_top_ref","calculateHeight","rect","fixed_element_top","viewport_height","window","innerHeight","F","containerHeightRatio","TestFC","DemoComponents","container_style","aspectRatio","opacityFunc","z_score","floor","PI","sin","WheelItem","Component","rotation","opacity_function","total_items","ScrollWheelContext","theta","asin","sqrt","items_per_half_turn","total_turns","current_angle","factor","getItemStyle","opacity","visibility","cos","setRotation","element","delta_y","tangent_distance","delta_theta","atan","useScrollController","onMouseLeave","Comp","DemoWheelScroll","DemoContainer"],"ignoreList":[],"sourceRoot":""}